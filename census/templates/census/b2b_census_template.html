{% extends 'census/base.html' %}
{% load static %}
{% block css %}
    <link rel="stylesheet" href="{% static 'css/census/style.css' %}">
{% endblock %}
{% block content %}
    {% include 'census/utils/checkbox.html' %}
    <div class="form-floating mb-3">
        <input type="text" name="full_address" class="form-control" id="address-input" placeholder="name@example.com">
        <label for="floatingInput">Адрес</label>
        <ul class="list-group address-result">
            <li class="list-group-item active" aria-current="true">An active item</li>
            <li class="list-group-item">A second item</li>
            <li class="list-group-item">A third item</li>
            <li class="list-group-item">A fourth item</li>
            <li class="list-group-item">And a fifth one</li>
            <li class="list-group-item">A third item</li>
            <li class="list-group-item">A fourth item</li>
            <li class="list-group-item">And a fifth one</li>
        </ul>
    </div>
    <script>

        function closeAnotherClick(not_include_class, close_object) {
            window.onclick = function (e) {
                console.log(e.target.classList)
                if (!Array.from(e.target.classList).includes(not_include_class)) {
                    close_object.style.display = 'none'
                }
            }
        }

        let result_list = document.querySelector('.address-result')
        let address_input = document.getElementById('address-input')
        address_input.addEventListener('keyup', (e) => {
            console.log(e.target.value)
            let clean_address = fetch("{% url 'clean_address' %}", {
                method: 'POST',
                headers: {
                    'X-CSRFToken': "{{ csrf_token }}"
                },
                body: JSON.stringify({
                    "address": e.target.value
                })
            })

            clean_address.then((res) => res.json().then((data) => {
                console.log(data)
                if (data.result.length > 0) {
                    result_list.style.display = 'block'
                } else {
                    result_list.style.display = 'none'
                }
            }))

            closeAnotherClick('list-group-item', result_list)
        })

    </script>
    {% include 'census/utils/inn_not_req.html' %}
    {% include 'census/utils/board.html' %}

        <p class="text-center" style="margin-top: 41px ">Сведения о торговой точке</p>


            <div class="mb-3">
{#        <label for="shopCategoryId" class="form-label">Категория точки?</label>#}
            <select class="form-select mb-3" name="category" style="color: #6c757d" id="shopCategoryId" data-url="{% url 'point_category' %}"
                    aria-describedby="pointCategoryIDFeedback" required>
                <option selected disabled value="">Выберите категорию точки...</option>
            </select>
            <div id="pointCategoryIDFeedback" class="invalid-feedback">
                Выберите нужную категорию торговой точки
            </div>
        </div>

{#        Парк техники? -----------------------#}
        <div class="mb-3 multi_res was-validated" id="equipmentIdDiv">
            <select class="form-select multiple mb-3" name="equipment" id="equipmentId"
                    required data-placeholder="Укажите парк техники?" multiple data-url="{% url 'get_equipment_park' %}">
            </select>
        </div>

        <p class="text-center" style="margin-top: 41px ">Сведения о потребляемых продуктах</p>

        {% include 'census/utils/products.html' %}

        <div class="mb-3 multi_res was-validated" id="volumeIdDiv">
            <select class="form-select multiple mb-3" name="volume" id="volumeId" required data-placeholder="Объем потребления?" multiple data-url="{% url 'get_volume_data' %}">
            </select>
        </div>

        {#        Общий объем #}
        <div class="form-floating mb-3" id="otherVolDivId" style="display: none;">
            <input class="form-control" id="otherVolId" type="text" name="all_volume" placeholder="Общий объем потребления?"
            aria-describedby="otherVolIdFeedback">
            <label for="otherId">Общий объем потребления?</label>
            <div id="otherVolIdFeedback" class="invalid-feedback">Напишите общий объем потребления?</div>
        </div>

        {% include 'census/utils/providers.html' %}
        {% include 'census/utils/other_provider.html' %}

        {% include 'census/utils/contact_person.html' %}

        <p class="text-center" style="margin-top: 41px ">Дополнительные сведения</p>

        <div class="mb-3" id="tenderDiv">
{#            <label for="tenderId" class="form-label">Работает по тендеру?</label>#}
            <select class="form-select mb-3" selected="" name="tender" id="tenderId" style="display: block;"
                    aria-describedby="tenderFeedback" required>
                <option selected disabled value="">Укажите, работает ли через тендер?</option>
                <option value="1">Да</option>
                <option value="0">Нет</option>
            </select>
            <div id="tenderFeedback" class="invalid-feedback">Работает по тендеру?</div>
        </div>
{% endblock %}