<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Сенсус {{ city }}, {{ street }}, {{ house }}</title>
    <!-- Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    <!-- Or for RTL support -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.rtl.min.css" />
    <!---Datepicker-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.full.min.js"></script>
    <!---Datepicker-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;apikey=65c2d6fb-b558-4d2c-9982-ccbd7b5a47b1"
            type="text/javascript"></script>
    {% load static %}
    <script defer src="{% static 'js/b2b.js' %}"></script>
    <script defer src="{% static 'js/search_inn.js' %}"></script>

    <script>
        let csrf="{{ csrf_token }}";
        let depart = "{{ depart }}"
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            CreateApp(document.getElementById('todo-app'));
        });
    </script>


</head>
<body>
<div class="container" id="todo-app" data-search="{% url 'partners' %}" data-address_id="{{ address_id }}">

    <h2 class="text-center m-4">Сенсус торговой точки</h2>
    <p class="text-center mb-3"><span class="fw-bold">Адрес: </span>{{ city }}, {{ street }}, {{ house }}</p>
    <form class="m-3" action="{% url 'census_load' %}" method="post" enctype="multipart/form-data">
        <div class="row m-3">
            <div class="form-check form-switch mb-3 col-lg-4">
                <input class="form-check-input" type="checkbox" id="workCheckbox">
                <label class="form-check-label" for="workCheckbox">Уже работаем с точкой?</label>
            </div>
            <div class="form-check form-switch mb-3 col-lg-4">
                <input class="form-check-input" name="not_communicate" type="checkbox" id="communicateCheckbox" value="true">
                <label class="form-check-label" for="communicateCheckbox">Нет коммуникации</label>
            </div>
            <div class="form-check form-switch mb-3 col-lg-4" id="closeDiv">
                <input class="form-check-input" name="closing" type="checkbox" id="closeCheckbox" value="true">
                <label class="form-check-label" for="workCheckbox">Точка не существует</label>
            </div>
        </div>
        <input class="form-control mb-3" name="working" list="contragentsListOptions" placeholder="Контрагент в 1С" id="searchClient"
               style="display: none;">
        <ul class="list-group mb-3" id="contragentsListOptions" style="display: none;"></ul>

{#        ИНН #}
        <div class="form-floating mb-3" id="innDivId" style="display: block;">
            <input class="form-control" id="innId" type="text" name="inn" placeholder="ИНН?"
            aria-describedby="innIdFeedback" data-url="{% url 'get_inn' %}" required>
            <label for="otherId">ИНН</label>
            <div id="innIdFeedback" class="invalid-feedback">Напишите ИНН точки</div>
        </div>

        <ul class="list-group list-group-flush mb-3" style="display: none" id="innSearchUl">
            <li class="list-group-item out" style="color: red;" disabled></li>
        </ul>
{#НАЗВАНИЕ ОРГАНИЗАЦИИ#}
        <div class="form-floating mb-3" id="organizationsNameDivId" style="display: block;">
            <input class="form-control" id="organizationsNameId" type="text" name="organizations_name" placeholder="Название организации?"
            aria-describedby="organizationsNameIdFeedback" required>
            <label for="otherId">Название организации</label>
            <div id="organizationsNameIdFeedback" class="invalid-feedback">Напишите название организации</div>
        </div>
{#        Вывеска -----------------------#}
        <div class="form-floating mb-3" id="boardId">
            <input class="form-control" name="point_name" id="signboardId" type="text" placeholder="Вывеска" aria-describedby="signboardIdFeedback" required>
            <label for="signboardId">Вывеска</label>
            <div id="signboardIdFeedback" class="invalid-feedback">
                Укажите вывеску торговой точки
            </div>
        </div>
{#    ФОТО #}
        <div class="mb-3">
          <label for="formFileMultiple" class="form-label">Фотографии точки</label>
          <input class="form-control" name="file" type="file" id="formFileMultiple" multiple required>
            <div class="invalid-feedback">Пожалуйста, загрузите фотографии точки</div>
        </div>

            <div class="mb-3">
        <label for="shopCategoryId" class="form-label">Категория точки?</label>
            <select class="form-select mb-3" name="category" id="shopCategoryId" data-url="{% url 'point_category' %}"
                    aria-describedby="pointCategoryIDFeedback" required>
                <option selected disabled value="">Выберите категорию...</option>
            </select>
            <div id="pointCategoryIDFeedback" class="invalid-feedback">
                Выберите нужную категорию торговой точки
            </div>
        </div>
    {#        Используемые продукты? -----------------------#}
{#        <div class="mb-3 multi_res was-validated" id="vectorMultiDiv">#}
{#            <select class="form-select multiple mb-3" name="vectors" id="vectorMulti"#}
{#                    required data-placeholder="Используемые продукты?" multiple data-url="{% url 'point_vectors' %}">#}
{#            </select>#}
{#        </div>#}
{#    hide products----------------- #}
{#        {% if products %}#}
{#            {% for product in products %}#}
{#                {% if product.name != "Другое" %}#}
{#            <div class="mb-3 multi_res was-validated" id="{{ product.slug }}_load" style="display: none">#}
{#                <label class="form-label" for="{{ product.slug }}">{{ product.name }}</label>#}
{#                <select class="form-select multiple mb-3" name="{{ product.slug }}" id="{{ product.slug }}"#}
{#                        data-placeholder="Какие {{ product.name }}?"#}
{#                        multiple data-url="{% url 'get_vectors_items' product.slug %}">#}
{#                </select>#}
{#            </div>#}
{#                {% endif %}#}
{#            {% endfor %}#}
{#        {% endif %}#}
{##}
        {#        Другие Используемые продукты?? -----------------------#}
{#        <div class="form-floating mb-3" id="otherVectorId" style="display: none;">#}
{#            <input class="form-control" name="other_vector" id="otherVectorInputId" type="text"#}
{#                   placeholder="Другие продукты" aria-describedby="otherVectorFeedback">#}
{#            <label for="otherVectorInputId">Какие другие продукты?</label>#}
{#            <div id="otherVectorFeedback" class="invalid-feedback">Выберите другие продукты торговой точки</div>#}
{#        </div>#}
            {% include 'census/utils/products.html' %}

{#        Парк техники? -----------------------#}
        <div class="mb-3 multi_res was-validated" id="equipmentIdDiv">
            <select class="form-select multiple mb-3" name="equipment" id="equipmentId"
                    required data-placeholder="Парк техники?" multiple data-url="{% url 'get_equipment_park' %}">
            </select>
        </div>

        {#        Поставщик         #}
        <div class="was-validated mb-3" id="providersDiv">
            <select class="form-select multiple" name="providers" data-placeholder="Поставщик" id="providers" data-url="{% url 'providers' %}" multiple required></select>
        </div>

        <div class="mb-3 multi_res was-validated" id="volumeIdDiv">
            <select class="form-select multiple mb-3" name="volume" id="volumeId" required data-placeholder="Объем потребления?" multiple data-url="{% url 'get_volume_data' %}">
            </select>
        </div>

    {#        Другой поставщик #}
        <div class="form-floating mb-3" id="otherProvDivId" style="display: none;">
            <input class="form-control" id="otherProvId" type="text" name="other_providers" placeholder="Какие другие поставщики?"
            aria-describedby="otherProvIdFeedback">
            <label for="otherId">Какие другие поставщики?</label>
            <div id="otherProvIdFeedback" class="invalid-feedback">Напишите других поставщиков торговой точки</div>
        </div>

    {% include 'census/utils/contact_person.html' %}

        <div class="mb-3" id="tenderDiv">
            <label for="tenderId" class="form-label">Работает по тендеру?</label>
            <select class="form-select mb-3" selected="" name="tender" id="tenderId" style="display: block;"
                    aria-describedby="tenderFeedback" required>
                <option selected disabled value="">Выберите...</option>
                <option value="1">Да</option>
                <option value="0">Нет</option>
            </select>
            <div id="tenderFeedback" class="invalid-feedback">Работает по тендеру?</div>
        </div>

    {% include 'census/utils/control.html' %}

        <div class="d-grid gap-2 mt-5">
            <button class="btn btn-danger" type="submit">Отправить</button>
        </div>
    {% include 'census/utils/hiddens.html' %}
    </form>
</div>



<script>
    let selects = document.querySelectorAll('.form-select.multiple')
    selects.forEach((item) => {
        let id = item.getAttribute('id')
        $( '#' + id ).select2( {
            theme: "bootstrap-5",
            width: $( this ).data( 'width' ) ? $( this ).data( 'width' ) : $( this ).hasClass( 'w-100' ) ? '100%' : 'style',
            placeholder: $( this ).data( 'placeholder' ),
            closeOnSelect: false,
            dropdownParent: $( '#' + id ).parent(),
        });
    })

    $(function(){
      $('#datepicker').datepicker({
          format:"dd-mm-yyyy"
      });
    });

    ymaps.ready(init);

    function init() {
        let geolocation = ymaps.geolocation;
        geolocation.get({
            provider: 'auto',
        }).then(function (result) {
            if (result.geoObjects.position) {
                document.getElementById('position').setAttribute('value', result.geoObjects.position)
            }
        });
    }
</script>
</body>
</html>